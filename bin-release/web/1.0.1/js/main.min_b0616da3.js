var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(t){a(t)}}function s(e){try{l(i["throw"](e))}catch(t){a(t)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],a=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseView=function(e){function t(){var t=e.call(this)||this;return t._loadList=[],t._grpName="",t.isRegister=!1,t.isComplete=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAdded,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoved,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"resource",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moduleName",{get:function(){return""},enumerable:!0,configurable:!0}),t.prototype.notificationListeners=function(){return[]},t.prototype.hideSelf=function(){this.visible=!1,Facade.removeNotifListeners(this)},t.prototype.showSelf=function(){this.visible=!0},t.prototype.executeNotification=function(e,t,n){},t.prototype.onAdded=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.readResourec()},t.prototype.readResourec=function(){this.resource.length>0?(this._loadList=this.resource.split("|"),this._grpName=this._loadList.shift(),this.loadGroup()):this.loadComplete()},t.prototype.loadGroup=function(){this.touchEnabled=!1,this.touchChildren=!1},t.prototype.loadComplete=function(){this.isComplete=!0,""!=this.moduleName&&(this.skinName=this.moduleName),Facade.registerNotifListeners(this)},t.prototype.onRemoved=function(e){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this),this.removeChildren()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(BaseView.prototype,"BaseView",["IMediator"]);var GameViewCE=function(e){function t(){var t=e.call(this)||this;return t.grp_container=new eui.Group,t.grp_container.width=720,t.grp_container.height=1280,t.addChild(t.grp_container),t}return __extends(t,e),Object.defineProperty(t.prototype,"moduleName",{get:function(){return"GameViewSkin"},enumerable:!0,configurable:!0}),t}(BaseView);__reflect(GameViewCE.prototype,"GameViewCE");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,i){function r(e){t.call(i,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(i))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(i,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(i,generateJSON.paths[e])},this):RES.getResByUrl(l,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(i,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?i(r):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var UpdateManager=function(){function e(){}return e.start=function(){this._started=!0},e.stop=function(){this._started=!1},e.init=function(){this._lastDelta=egret.getTimer(),egret.startTick(this.update,this)},e.update=function(e){var t=e-this._lastDelta;if(this._lastDelta=e,this._started)for(var n=this._dicupdateable.length-1;n>=0;n--)this._dicupdateable[n].deleted?this._dicupdateable.splice(n,1):this._dicupdateable[n].update(t);return!1},e.addUpdateable=function(e){var t=this._dicupdateable.indexOf(e);e.deleted=!1,-1==t&&this._dicupdateable.push(e)},e.delUpdateable=function(e){var t=this._dicupdateable.indexOf(e);t>-1&&(this._dicupdateable[t].deleted=!0)},e._dicupdateable=[],e._started=!1,e}();__reflect(UpdateManager.prototype,"UpdateManager");var XMLManager=function(){function e(){this._jsZip=null,this._dicData={},this._levelData={},this._maxLevel=1}return e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},e.prototype.getDataByName=function(e){return this._dicData[e]},e.prototype.readJsZipJson=function(e){this._jsZip=new JSZip(e);try{var t=JSON.parse(this._jsZip.file("all.json").asText());for(var n in t){var i=egret.getDefinitionByName(n+"Vo");if(i){for(var r=t[n],a={},o=null,s=0;s<r.length;++s)o=new i(r[s]),a[o.ID]=o;this._dicData[n]=a}}}catch(l){}},e}();__reflect(XMLManager.prototype,"XMLManager");var Facade=function(){function e(){}return e.sendNotification=function(t,n,i){var r=e._dicmediator[t];if(null!=r)for(var a=0;a<r.length;a++)r[a].executeNotification(t,n,i)},e.registerNotifListeners=function(t){if(!t.isRegister){t.isRegister=!0;for(var n=t.notificationListeners(),i=n.length,r=0;i>r;r++){var a=e._dicmediator[n[r]];null!=a?a.push(t):(a=new Array,a.push(t),e._dicmediator[n[r]]=a)}}},e.removeNotifListeners=function(e){},e._dicmediator=new Array,e}();__reflect(Facade.prototype,"Facade");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.addBgAndLogo(),t.addLoading(),t}return __extends(t,e),t.prototype.addBgAndLogo=function(){var e=new eui.Image("loadingBg_png");e.x=e.y=0,this.addChild(e);var t=new eui.Image("logo_wuzhuang_png");t.y=40,this.addChild(t)},t.prototype.addLoading=function(){var e=new eui.Component;e.width=500,e.x=(720-e.width)/3,e.y=900,this.addChild(e);var t=new egret.Rectangle(19,14,4,2);this._bgLoading=new eui.Image("loading_progress_bg_png"),this._bgLoading.scale9Grid=t,this._bgLoading.width=500,e.addChild(this._bgLoading),this._loading=new eui.Image("loading_progress_line_png"),this._loading.scale9Grid=t,e.addChild(this._loading)},t.prototype.onProgress=function(e,t){this._loading.width=e/t*this._bgLoading.width},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var UIRocker=function(e){function t(t,n,i,r){void 0===r&&(r=0);var a=e.call(this)||this;return a._bgImg=new eui.Image,a._ball=new eui.Image,a._sp=new egret.Sprite,a._radius=110,a._ballRadius=30,a._centerP=new egret.Point,a._movePoint=new egret.Point,a._touchId=0,a._range=t,a.initUI(n,i,r),a}return __extends(t,e),t.prototype.initUI=function(e,t,n){return void 0===n&&(n=0),__awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(a){switch(a.label){case 0:return this._rect=new eui.Rect(this._range.width,this._range.height),this._rect.alpha=n,this._rect.x=this._range.x,this._rect.y=this._range.y,this.addChild(this._rect),i=this._bgImg,[4,RES.getResAsync(e)];case 1:return i.texture=a.sent(),this._radius=this._bgImg.width>>1,this._bgImg.anchorOffsetX=this._radius,this._bgImg.anchorOffsetY=this._radius,r=this._ball,[4,RES.getResAsync(t)];case 2:return r.texture=a.sent(),this._ballRadius=this._ball.width>>1,this._ball.anchorOffsetX=this._ball.anchorOffsetY=this._ballRadius,this._sp.addChild(this._bgImg),this._sp.addChild(this._ball),this._restPoint||(this._restPoint=new egret.Point(this._range.x+.5*this._range.width,this._range.y+.5*this._range.height)),this._sp.touchEnabled=this._sp.touchChildren=!1,this._sp.visible=!1,[2]}})})},t.prototype.touchBeginHandler=function(e){0==this._touchId&&(this._sp.x=e.stageX-GameGlobal.offsetX,this._sp.y=e.stageY,this._centerP.x=this._sp.x,this._centerP.y=this._sp.y,this.show(),this._touchId=e.touchPointID,this.touchMoveHandler(e),GameGlobal.baseLayer.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),GameGlobal.baseLayer.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.cancelHandler,this),GameGlobal.baseLayer.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.cancelHandler,this))},t.prototype.touchMoveHandler=function(e){if(this._touchId==e.touchPointID){var n=e.stageX-GameGlobal.offsetX,i=e.stageY;this._movePoint.x=n,this._movePoint.y=i;var r=egret.Point.distance(this._centerP,this._movePoint);if(t.angle=Math.atan2(i-this._centerP.y,n-this._centerP.x),r>=this._radius){var a=Math.cos(t.angle)*this._radius,o=Math.sin(t.angle)*this._radius;this._centerP.x=this._sp.x=n-a,this._centerP.y=this._sp.y=i-o}if(this._ball.x=n-this._centerP.x,this._ball.y=i-this._centerP.y,10>r)return void(RockerControl.getInstance().dirState.state=0);RockerControl.getInstance().dirState.state=RockerControl.judgeDir(-t.angle),RockerControl.getInstance().dirState.rotation=90+180*t.angle/Math.PI}},t.prototype.cancelHandler=function(e){this._touchId==e.touchPointID&&(this.reset(),GameGlobal.baseLayer.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),GameGlobal.baseLayer.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.cancelHandler,this),GameGlobal.baseLayer.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.cancelHandler,this),t.angle=0,RockerControl.getInstance().dirState.state=0)},t.prototype.show=function(){0==this._sp.x&&(this._sp.x=360,this._sp.y=1100),!this._sp.parent&&this.addChild(this._sp)},t.prototype.reset=function(){this._touchId=0,this._ball.x=0,this._ball.y=0,this._sp.x=this._restPoint.x,this._sp.y=this._restPoint.y},t.prototype.hide=function(){this._touchId=0,this._sp.parent&&this._sp.parent.removeChild(this._sp)},t.prototype.start=function(){this._rect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this)},t.prototype.stop=function(){RockerControl.getInstance().dirState.state=0,this._rect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this),GameGlobal.baseLayer.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),GameGlobal.baseLayer.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.cancelHandler,this),GameGlobal.baseLayer.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.cancelHandler,this)},t.prototype.onAdded=function(e){this.start()},t.prototype.onRemoved=function(e){this.hide(),this.stop()},Object.defineProperty(t.prototype,"startPoint",{set:function(e){this._restPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"angle",{get:function(){return this._angle},set:function(e){this._angle=e},enumerable:!0,configurable:!0}),t._angle=0,t}(BaseView);__reflect(UIRocker.prototype,"UIRocker");var DirState=function(){function e(){this._state=0,this._rotation=0}return Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){if(this._state!=e)switch(this._state=e,this._state){case 1:this._rotation=225;break;case 2:this._rotation=180;break;case 3:this._rotation=135;break;case 4:this._rotation=270;break;case 6:this._rotation=90;break;case 7:this._rotation=315;break;case 8:this._rotation=0;break;case 9:this._rotation=45;break;default:this._rotation=0}this._isChanged=e>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChanged",{get:function(){return this._isChanged},enumerable:!0,configurable:!0}),e}();__reflect(DirState.prototype,"DirState");var RockerControl=function(){function e(){this.dirState=new DirState,this.isBattle=!0,this.keys=""}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.judgeDir=function(e){var t,n=180*e/Math.PI;return t=n>-157.5&&-112.5>n?1:n>-112.5&&-67.5>=n?2:n>-67.5&&-22.5>=n?3:n>-22.5&&22.5>=n?6:n>22.5&&67.5>=n?9:n>67.5&&112.5>=n?8:n>112.5&&157.5>=n?7:4},e}();__reflect(RockerControl.prototype,"RockerControl");var GameEvent=function(){function e(){}return e.OPEN_VIEW="GameEvent_Open_View",e}();__reflect(GameEvent.prototype,"GameEvent");var GameGlobal=function(){function e(){}return e.initGame=function(e){this._baseLayer=e,e.touchEnabled=!1,this._gameLayer=new eui.UILayer,this._gameLayer.name="gameLayer",e.addChild(this._gameLayer),this._gameLayer.touchThrough=!0,this._gameLayer.touchEnabled=!1,this._uiLayer=new eui.UILayer,this._uiLayer.name="uiLayer",e.addChild(this._uiLayer),this._uiLayer.touchEnabled=!1,this._uiLayer.touchThrough=!0,this._uiLayer.$hitTest=function(){return null},this._popLayer=new eui.UILayer,this._popLayer.name="popLayer",e.addChild(this._popLayer),this._popLayer.touchThrough=!0,this._popLayer.touchEnabled=!1,this._popLayer.touchChildren=!0,this._tipsLayer=new eui.UILayer,this._tipsLayer.name="tipsLayer",e.addChild(this._tipsLayer),this._tipsLayer.touchEnabled=!1,this._tipsLayer.touchThrough=!0,this.topLayer=new eui.UILayer,this.topLayer.name="topLayer",e.addChild(this.topLayer),this.topLayer.touchThrough=!0,this.topLayer.touchEnabled=!1,this.toastLayer=new eui.UILayer,this.toastLayer.name="toastLayer",e.addChild(this.toastLayer),this.toastLayer.touchThrough=!0,this.toastLayer.touchEnabled=!1,this._loadingLayer=new eui.UILayer,this._loadingLayer.name="loadingLayer",this._loadingLayer.touchEnabled=this._loadingLayer.touchChildren=!1,e.addChild(this._loadingLayer),this._loadingLayer.touchThrough=!0,UpdateManager.init(),UpdateManager.start(),this.isComplete=!0},Object.defineProperty(e,"gameLayer",{get:function(){return e._gameLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e,"gameType",{get:function(){return this._gameType},set:function(e){this._gameType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"baseLayer",{get:function(){return this._baseLayer},enumerable:!0,configurable:!0}),e.isComplete=!1,e.screenWidth=720,e.screenHeight=1280,e.offsetX=0,e.offsetY=0,e}();__reflect(GameGlobal.prototype,"GameGlobal");var GameViewType;!function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.Battle=2]="Battle"}(GameViewType||(GameViewType={}));var GameView=function(e){function t(){var t=e.call(this)||this;return t._classMap=[null,StartView,BattleView],t._forceArray=[GameViewType.Battle],t._forceDic={},t}return __extends(t,e),Object.defineProperty(t.prototype,"resource",{get:function(){return""},enumerable:!0,configurable:!0}),t.prototype.notificationListeners=function(){return[GameEvent.OPEN_VIEW]},t.prototype.executeNotification=function(e,t,n){if(e==GameEvent.OPEN_VIEW){var i=t,r=!1,a=null,o=void 0,s=this._classMap[i];if(n&&(a=n,("open"==n.type||"open"==n.openType||"open"==n)&&(r=!0)),i!=GameGlobal.gameType){GameGlobal.gameType=i,this.grp_container.removeChildren();for(var l=0;l<this.grp_ForceView.numChildren;l++)this.grp_ForceView.getChildAt(l).hideSelf();if(this._forceArray.indexOf(i)>=0){if(null!=s){var c=this._forceDic[i];if(null==c){var h=new s;this._forceDic[i]=h,this.grp_container.addChild(h)}else c.showSelf()}}else null!=s&&(o=new s,this.grp_container.addChild(o))}}},t.prototype.onAdded=function(t){e.prototype.onAdded.call(this,t)},t.prototype.loadComplete=function(){e.prototype.loadComplete.call(this),GameGlobal.gameType=GameViewType.Start,this.grp_container.addChild(new StartView)},t}(GameViewCE);__reflect(GameView.prototype,"GameView");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[4,RES.getResAsync("jszip_zip")];case 2:return e=t.sent(),[4,XMLManager.getInstance().readJsZipJson(e)];case 3:return t.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),[4,RES.loadConfig("default.res.json","resource")];case 1:return n.sent(),[4,RES.loadGroup("first")];case 2:return n.sent(),e=new LoadingUI,this.stage.addChild(e),[4,this.loadTheme()];case 3:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 4:return n.sent(),this.stage.removeChild(e),[3,6];case 5:return t=n.sent(),console.error(t),[3,6];case 6:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var i=new eui.Theme("resource/default.thm.json",e.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){GameGlobal.initGame(this),GameGlobal.gameLayer.addChild(new GameView)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t.prototype.startAnimation=function(e){var t=this,n=new egret.HtmlTextParser,i=e.map(function(e){return n.parse(e)}),r=this.textfield,a=-1,o=function(){a++,a>=i.length&&(a=0);var e=i[a];r.textFlow=e;var n=egret.Tween.get(r);n.to({alpha:1},200),n.wait(2e3),n.to({alpha:0},200),n.call(o,t)};o()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var BattleView=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.notificationListerners=function(){return[]},t.prototype.executeNotification=function(e,t,n){},Object.defineProperty(t.prototype,"moduleName",{get:function(){return"StartViewSkin"},enumerable:!0,configurable:!0}),t.prototype.loadComplete=function(){e.prototype.loadComplete.call(this)},t.prototype.update=function(e){},t}(BaseView);__reflect(BattleView.prototype,"BattleView",["IUpdateable"]);var Bullet=function(e){function t(){var t=e.call(this)||this;return t.scaleV=.02,t.scaleX=t.scaleY=t.scaleV,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.added,t),t}return __extends(t,e),t.prototype.added=function(){var e=RES.getRes("b_json"),t=RES.getRes("b_png"),n=new egret.MovieClipDataFactory(e,t),i=new egret.MovieClip(n.generateMovieClipData("timg"));this.addChild(i),i.play(10)},t}(egret.Sprite);__reflect(Bullet.prototype,"Bullet");var Plane=function(e){function t(){var t=e.call(this)||this;return t.platMoveSpeed=4,t.sendBulletDelta=300,t._sendBulletDelta=0,t.bulletMoveSpeed=5,t.bulletDic=[],t.isMe=!0,t.scaleV=.5,t._sendBulletDelta=t.sendBulletDelta,t.scaleX=t.scaleY=t.scaleV,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.added,t),t}return __extends(t,e),t.prototype.added=function(){this.addChild(new egret.Bitmap(RES.getRes("hongZhaJi")))},t.prototype.update=function(e,t){this.sendBullets(e,t),this.movePlane(t),this.moveBullets()},t.prototype.sendBullets=function(e,t){if(this._sendBulletDelta-=e,this._sendBulletDelta<0){this._sendBulletDelta=this.sendBulletDelta;var n=new Bullet;this.bulletDic.push(n),t.addChild(n),n.x=this.x+this.width/4,n.y=this.y}},t.prototype.movePlane=function(e){var t=RockerControl.getInstance().dirState;if(0!=t.state&&this.isMe){var n=this.platMoveSpeed*Math.cos((t.rotation-90)*Math.PI/180),i=this.platMoveSpeed*Math.sin((t.rotation-90)*Math.PI/180);this.x+=n,this.y+=i,e.sendWs()}},t.prototype.moveBullets=function(){for(var e,t=0;t<this.bulletDic.length;t++)e=this.bulletDic[t],e.y-=this.bulletMoveSpeed},t}(egret.Sprite);__reflect(Plane.prototype,"Plane");var Socket=function(){function e(){}return e.prototype.testWsHttp=function(){this.sock=new egret.WebSocket,this.sock.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.sock.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.sock.connect("127.0.0.1",9502)},e.prototype.onReceiveMessage=function(e){var t=this.sock.readUTF();console.log("收到数据："+t)},e.prototype.onSocketOpen=function(e){var t="Hello Egret WebSocket";console.log("连接成功，发送数据："+t),this.sock.writeUTF(t)},e.prototype.sendWs=function(e){var t='{"cmd":"uzwan_login","gameId":"0","from":"guzwan","userId":"3565526"}';this.sock.writeUTF(t)},e}();__reflect(Socket.prototype,"Socket");var StartView=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.notificationListerners=function(){return[]},t.prototype.executeNotification=function(e,t,n){},Object.defineProperty(t.prototype,"moduleName",{get:function(){return""},enumerable:!0,configurable:!0}),t.prototype.loadComplete=function(){e.prototype.loadComplete.call(this),this.init(),UpdateManager.addUpdateable(this),this.connetWsHttp()},t.prototype.init=function(){var e=new UIRocker(new egret.Rectangle(0,0,720,1280),"ctrl_direction_1_png","ctrl_direction_2_png");e.startPoint=new egret.Point(360,1100),this.addChildAt(e,this.numChildren-3),this._MyPlane=new Plane,this._MyPlane.x=100,this._MyPlane.y=GameGlobal.screenHeight-this._MyPlane.height-300,this.addChild(this._MyPlane),this._FriendPlane=new Plane,this._FriendPlane.x=450,this._FriendPlane.y=GameGlobal.screenHeight-this._FriendPlane.height-300,this._FriendPlane.isMe=!1,this.addChild(this._FriendPlane)},t.prototype.update=function(e){this._MyPlane.update(e,this),this._FriendPlane.update(e,this)},t.prototype.connetWsHttp=function(){this.sock=new egret.WebSocket,this.sock.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.sock.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.sock.connect("127.0.0.1",9502)},t.prototype.onReceiveMessage=function(e){var t=this.sock.readUTF(),n=JSON.parse(t);switch(n.tye){case 1:var i=n.isMaster;0==i&&(this._MyPlane.isMe=!1,this._FriendPlane.isMe=!0);break;case 2:this._FriendPlane.x=n.x,this._FriendPlane.y=n.y}console.log("收到数据："+t)},t.prototype.onSocketOpen=function(e){var t="Hello Egret WebSocket";console.log("连接成功，发送数据："+t)},t.prototype.sendWs=function(){var e={type:2,x:this._MyPlane.x,y:this._MyPlane.y},t=JSON.stringify(e);this.sock.writeUTF(t)},t}(BaseView);__reflect(StartView.prototype,"StartView",["IUpdateable"]);